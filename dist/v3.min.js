!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("v3",[],i):"object"==typeof exports?exports.v3=i():t.v3=i()}(window,function(){return function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=7)}([function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,s=e(2),h=(n=s)&&n.__esModule?n:{default:n};var r=function(t){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e,n,0,s,h,r,0,o,a,m,0,u,l,c,1))}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,h.default),i}();i.default=r},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();var s=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=e,this.z=n}return n(t,[{key:"normalize",value:function(){var i=t.getNorm(this);i&&(this.x=this.x/i,this.y=this.y/i,this.z=this.z/i)}},{key:"getVec3FloatArray",value:function(){return new Float32Array([this.x,this.y,this.z])}},{key:Symbol.iterator,value:function(){var t=[this.x,this.y,this.z],i=0;return{next:function(){return{done:i===t.length,value:t[i++]}}}}}],[{key:"isEqual",value:function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z}},{key:"negate",value:function(i){return new t(-i.x,-i.y,-i.z)}},{key:"plus",value:function(){for(var i=arguments.length,e=Array(i),n=0;n<i;n++)e[n]=arguments[n];return 2===e.length?new t(e[0].x+e[1].x,e[0].y+e[1].y,e[0].z+e[1].z):new t(e.map(function(t){return t.x}).reduce(function(t,i){return t+i},0),e.map(function(t){return t.y}).reduce(function(t,i){return t+i},0),e.map(function(t){return t.z}).reduce(function(t,i){return t+i},0))}},{key:"scalarMultiply",value:function(i,e){return new t(i*e.x,i*e.y,i*e.z)}},{key:"getNorm",value:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}},{key:"getDistance",value:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z))}},{key:"dotProduct",value:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}},{key:"getAngle",value:function(i,e){return Math.acos(t.dotProduct(i,e)/(t.getNorm(i)*t.getNorm(e)))}},{key:"crossProduct",value:function(i,e){return new t(i.y*e.z-i.z*e.y,i.z*e.x-i.x*e.z,i.x*e.y-i.y*e.x)}}]),t}();i.default=s},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),s=o(e(1)),h=o(e(3)),r=o(e(0));function o(t){return t&&t.__esModule?t:{default:t}}function a(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)}var m=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,v=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,d=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.m11=i,this.m12=e,this.m13=n,this.m14=s,this.m21=h,this.m22=r,this.m23=o,this.m24=a,this.m31=m,this.m32=u,this.m33=l,this.m34=c,this.tx=y,this.ty=f,this.tz=v,this.tw=d}return n(t,[{key:"identity",value:function(){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.tx=0,this.ty=0,this.tz=0,this.tw=1}},{key:"clearTranslation",value:function(){this.tx=this.ty=this.tz=0}},{key:"setTranslation",value:function(t){this.tx=t.x,this.ty=t.y,this.tz=t.z}},{key:"setupTranslation",value:function(t){this.identity(),this.setTranslation(t)}},{key:"setupLocalToParentFromEulerAngle",value:function(i,e){var n=t.fromEulerAngle(e);this.setupLocalToParentFromRotationMatrix(i,n)}},{key:"setupLocalToParentFromRotationMatrix",value:function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m14=i.m14,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m24=i.m24,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.m34=i.m34,this.tx=t.x,this.ty=t.y,this.tz=t.z,this.tw=i.tw}},{key:"setupParentToLocalFromEulerAngle",value:function(i,e){var n=t.fromEulerAngle(e);this.setupParentToLocalFromRotationMatrix(i,n)}},{key:"setupParentToLocalFromRotationMatrix",value:function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m14=i.m14,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m24=i.m24,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.m34=i.m34,this.tx=-(t.x*this.m11+t.y*this.m21+t.z*this.m31),this.ty=-(t.x*this.m12+t.y*this.m22+t.z*this.m32),this.tz=-(t.x*this.m13+t.y*this.m23+t.z*this.m33),this.tw=i.tw}},{key:"setupRotateFromXYZAxis",value:function(t,i){var e=Math.sin(i),n=Math.cos(i);switch(t){case"x":case"X":this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=n,this.m23=e,this.m24=0,this.m31=0,this.m32=-e,this.m33=n,this.m34=0;break;case"y":case"Y":this.m11=n,this.m12=0,this.m13=-e,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=e,this.m32=0,this.m33=n,this.m34=0;break;case"z":case"Z":this.m11=n,this.m12=e,this.m13=0,this.m14=0,this.m21=-e,this.m22=n,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0}this.tx=0,this.ty=0,this.tz=0,this.tw=1}},{key:"setupRotateFromVector3",value:function(t,i){if(Math.abs(s.default.getNorm(t)-1)>.01)throw Error("旋转轴向量应为单位向量!");var e=Math.sin(i),n=Math.cos(i),h=1-n,r=h*t.x,o=h*t.y,a=h*t.z;this.m11=r*t.x+n,this.m12=r*t.y+t.z*e,this.m13=r*t.z-t.y*e,this.m14=0,this.m21=o*t.x-t.z*e,this.m22=o*t.y+n,this.m23=o*t.z+t.x*e,this.m24=0,this.m31=a*t.x+t.y*e,this.m32=a*t.y-t.x*e,this.m33=a*t.z+n,this.m34=0,this.tx=0,this.ty=0,this.tz=0,this.tw=1}},{key:"setupScale",value:function(t){this.m11=t.x,this.m12=0,this.m13=0,this.m21=0,this.m22=t.y,this.m23=0,this.m31=0,this.m32=0,this.m33=t.z,this.tx=0,this.ty=0,this.tz=0,this.m14=this.m24=this.m34=0,this.tw=1}},{key:"setupScaleFromAxis",value:function(t,i){if(Math.abs(s.default.getNorm(t)-1)>.01)throw Error("旋转轴向量应为单位向量!");var e=i-1,n=e*t.x,h=e*t.y,r=e*t.z;this.m11=n*t.x+1,this.m22=h*t.y+1,this.m33=r*t.z+1,this.m12=this.m21=n*t.y,this.m13=this.m31=n*t.z,this.m23=this.m32=h*t.z,this.tx=this.ty=this.tz=0,this.m14=this.m24=this.m34=0,this.tw=1}},{key:"setupShear",value:function(t,i,e){switch(t){case"x":case"X":this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=i,this.m32=e,this.m33=1;break;case"y":case"Y":this.m11=1,this.m12=0,this.m13=0,this.m21=i,this.m22=1,this.m23=e,this.m31=0,this.m32=0,this.m33=1;break;case"z":case"Z":this.m11=1,this.m12=i,this.m13=e,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1}this.tx=this.ty=this.tx=0,this.m14=this.m24=this.m34=0,this.tw=1}},{key:"setupReflection",value:function(t){if(Math.abs(s.default.getNorm(t)-1)>.01)throw Error("反射平面法向量应为单位向量!");var i=-2*t.x,e=-2*t.y,n=-2*t.z;this.m11=1+i*t.x,this.m22=1+e*t.y,this.m33=1+n*t.z,this.m12=this.m21=i*t.y,this.m13=this.m31=i*t.z,this.m23=this.m32=e*t.z,this.tx=this.ty=this.tz=0,this.m14=this.m24=this.m34=0,this.tw=1}},{key:"transpose",value:function(){var t=[this.m11,this.m21,this.m31,this.tx,this.m12,this.m22,this.m32,this.ty,this.m13,this.m23,this.m33,this.tz,this.m14,this.m24,this.m34,this.tw];this.m11=t[0],this.m12=t[1],this.m13=t[2],this.m14=t[3],this.m21=t[4],this.m22=t[5],this.m23=t[6],this.m24=t[7],this.m31=t[8],this.m32=t[9],this.m33=t[10],this.m34=t[11],this.tx=t[12],this.ty=t[13],this.tz=t[14],this.tw=t[15]}},{key:"getMat4FloatArray",value:function(){return new Float32Array([this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.tx,this.ty,this.tz,this.tw])}},{key:"setLookAt",value:function(i,e,n){var o=s.default.plus(i,s.default.negate(e));o.normalize();var m=n;m.normalize();var u=s.default.crossProduct(m,o);u.normalize();var l=new(Function.prototype.bind.apply(h.default,[null].concat(a(u),a(m),a(o)))),c=new r.default;c.identity(),c.setTranslation(i),c.setTranslation(s.default.negate(i)),l.transpose();var y=t.matrix4Multiply(c,l);this.m11=y.m11,this.m12=y.m12,this.m13=y.m13,this.m14=y.m14,this.m21=y.m21,this.m22=y.m22,this.m23=y.m23,this.m24=y.m24,this.m31=y.m31,this.m32=y.m32,this.m33=y.m33,this.m34=y.m34,this.tx=y.tx,this.ty=y.ty,this.tz=y.tz,this.tw=y.tw}},{key:"setOrtho",value:function(t,i,e,n,s,h){this.m11=2/(i-t),this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=2/(n-e),this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=-2/(h-s),this.m34=0,this.tx=-(i+t)/(i-t),this.ty=-(n+e)/(n-e),this.tz=-(h+s)/(h-s),this.tw=1}},{key:"setPerspective",value:function(t,i,e,n){var s=Math.tan(Math.PI/2-t/2),h=1/(e-n);this.m11=s/i,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=s,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=h*(e+n),this.m34=-1,this.tx=0,this.ty=0,this.tz=2*e*n*h,this.tw=0}},{key:Symbol.iterator,value:function(){var t=[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.tx,this.ty,this.tz,this.tw],i=0;return{next:function(){return{done:i===t.length,value:t[i++]}}}}}],[{key:"scalarMultiply",value:function(i,e){return new t(e.m11*i,e.m12*i,e.m13*i,e.m14*i,e.m21*i,e.m22*i,e.m23*i,e.m24*i,e.m31*i,e.m32*i,e.m33*i,e.m34*i,e.tx*i,e.ty*i,e.tz*i,e.tw*i)}},{key:"fromEulerAngle",value:function(t){var i=Math.sin(t.heading),e=Math.cos(t.heading),n=Math.sin(t.picth),s=Math.cos(t.picth),r=Math.sin(t.bank),o=Math.cos(t.bank),a=e*o+i*n*r,m=-e*r+i*n*o,u=i*s,l=r*s,c=o*s,y=-n,f=-i*o+e*n*r,v=r*i+e*n*o,d=e*s;return new h.default(a,m,u,l,c,y,f,v,d)}},{key:"fromWorldToObjectQuaternion",value:function(t){var i=1-2*t.y*t.y-2*t.z*t.z,e=2*t.x*t.y+2*t.w*t.z,n=2*t.x*t.z-2*t.w*t.y,s=2*t.x*t.y-2*t.w*t.z,r=1-2*t.x*t.x-2*t.z*t.z,o=2*t.y*t.z+2*t.w*t.x,a=2*t.x*t.z+2*t.w*t.y,m=2*t.y*t.z-2*t.w*t.x,u=1-2*t.x*t.x-2*t.y*t.y;return new h.default(i,e,n,s,r,o,a,m,u)}},{key:"fromObjectToWorldQuaternion",value:function(t){var i=1-2*t.y*t.y-2*t.z*t.z,e=2*t.x*t.y-2*t.w*t.z,n=2*t.x*t.z+2*t.w*t.y,s=2*t.x*t.y+2*t.w*t.z,r=1-2*t.x*t.x-2*t.z*t.z,o=2*t.y*t.z-2*t.w*t.x,a=2*t.x*t.z-2*t.w*t.y,m=2*t.y*t.z+2*t.w*t.x,u=1-2*t.x*t.x-2*t.y*t.y;return new h.default(i,e,n,s,r,o,a,m,u)}},{key:"vector3Multiply",value:function(t,i){var e=t.x*i.m14+t.y*i.m24+t.z*i.m34+i.tw;if(0===e)throw Error("Vector3 W = 0 ERROR!");return new s.default((t.x*i.m11+t.y*i.m21+t.z*i.m31+i.tx)/e,(t.x*i.m12+t.y*i.m22+t.z*i.m32+i.ty)/e,(t.x*i.m13+t.y*i.m23+t.z*i.m33+i.tz)/e)}},{key:"matrix4Multiply",value:function(){for(var i=arguments.length,e=Array(i),n=0;n<i;n++)e[n]=arguments[n];if(e.length<2)throw Error("矩阵叉乘至少需要两个参数");return e.reduce(function(i,e){return new t(i.m11*e.m11+i.m12*e.m21+i.m13*e.m31+i.m14*e.tx,i.m11*e.m12+i.m12*e.m22+i.m13*e.m32+i.m14*e.ty,i.m11*e.m13+i.m12*e.m23+i.m13*e.m33+i.m14*e.tz,i.m11*e.m14+i.m12*e.m24+i.m13*e.m34+i.m14*e.tw,i.m21*e.m11+i.m22*e.m21+i.m23*e.m31+i.m24*e.tx,i.m21*e.m12+i.m22*e.m22+i.m23*e.m32+i.m24*e.ty,i.m21*e.m13+i.m22*e.m23+i.m23*e.m33+i.m24*e.tz,i.m21*e.m14+i.m22*e.m24+i.m23*e.m34+i.m24*e.tw,i.m31*e.m11+i.m32*e.m21+i.m33*e.m31+i.m34*e.tx,i.m31*e.m12+i.m32*e.m22+i.m33*e.m32+i.m34*e.ty,i.m31*e.m13+i.m32*e.m23+i.m33*e.m33+i.m34*e.tz,i.m31*e.m14+i.m32*e.m24+i.m33*e.m34+i.m34*e.tw,i.tx*e.m11+i.ty*e.m21+i.tz*e.m31+e.tx+i.tw*e.tx,i.tx*e.m12+i.ty*e.m22+i.tz*e.m32+e.ty+i.tw*e.ty,i.tx*e.m13+i.ty*e.m23+i.tz*e.m33+e.tz+i.tw*e.tz,i.tx*e.m14+i.ty*e.m24+i.tz*e.m34+e.tz+i.tw*e.tw)})}}]),t}();i.default=m},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,s=e(0),h=(n=s)&&n.__esModule?n:{default:n};var r=function(t){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e,n,s,h,r,o,a,m,0,0,0))}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,h.default),i}();i.default=r},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.wrapPi=function(t){return t+=Math.PI,t-=2*Math.floor(1*t/2/Math.PI)*Math.PI,t-=Math.PI},i.safeAcos=function(t){if(t>=1)return 0;if(t<=-1)return Math.PI;return Math.acos(t)}},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,s=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),h=e(1),r=(n=h)&&n.__esModule?n:{default:n},o=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(e(4));var a=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=i,this.x=e,this.y=n,this.z=s}return s(t,[{key:"setToRotateAboutX",value:function(t){this.w=Math.cos(t/2),this.x=Math.sin(t/2),this.y=0,this.z=0}},{key:"setToRotateAboutY",value:function(t){this.w=Math.cos(t/2),this.x=0,this.y=Math.sin(t/2),this.z=0}},{key:"setToRotateAboutZ",value:function(t){this.w=Math.cos(t/2),this.x=0,this.y=0,this.z=Math.sin(t/2)}},{key:"setToRotateAboutAxis",value:function(t,i){if(r.default.getNorm(t)-1>=.01)throw Error("构建四元数时，旋转轴向量必须标准化");this.w=Math.cos(i/2),this.x=Math.sin(i/2)*t.x,this.y=Math.sin(i/2)*t.y,this.z=Math.sin(i/2)*t.z}},{key:"normalize",value:function(){var i=t.getNorm(this);i?(this.w=this.w/i,this.x=this.x/i,this.y=this.y/i,this.z=this.z/i):(this.w=1,this.x=0,this.y=0,this.z=0)}},{key:"getRotationAngle",value:function(){return 2*o.safeAcos(this.w)}},{key:"getRotationAxis",value:function(){var t=Math.sqrt(1-this.w*this.w);return t?new r.default(this.x/t,this.y/t,this.z/t):new r.default(1,0,0)}}],[{key:"negate",value:function(i){return new t(-i.w,-i.x,-i.y,-i.z)}},{key:"getNorm",value:function(t){return Math.sqrt(t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z)}},{key:"getConjugate",value:function(i){return new t(i.w,-i.x,-i.y,-i.z)}},{key:"dotProduct",value:function(t,i){return t.w*i.w+t.x*i.x+t.y*i.y+t.z*i.z}},{key:"crossProduct",value:function(){for(var i=arguments.length,e=Array(i),n=0;n<i;n++)e[n]=arguments[n];if(e.length<2)throw Error("四元数叉乘至少需要两个参数");return e.reduce(function(i,e){return new t(i.w*e.w-i.x*e.x-i.y*e.y-i.z*e.z,i.w*e.x+i.x*e.w+i.z*e.y-i.y*e.z,i.w*e.y+i.y*e.w+i.x*e.z-i.z*e.x,i.w*e.z+i.z*e.w+i.y*e.x-i.x*e.y)})}},{key:"scalarMultiply",value:function(i,e){return new t(i*e.w,i*e.x,i*e.y,i*e.z)}},{key:"log",value:function(i){var e=i.getRotationAngle();return new t(0,e/2*i.x,e/2*i.y,e/2*i.z)}},{key:"pow",value:function(i,e){if(Math.abs(i.w)>.999)return i;var n=o.safeAcos(i.w),s=n*e,h=Math.sin(s)/Math.sin(n);return new t(Math.cos(n),i.x*h,i.y*h,i.z*h)}},{key:"getAngularDisplacement",value:function(i,e){return t.crossProduct(t.getConjugate(i),e)}},{key:"slerp",value:function(i,e,n){var s=void 0,h=void 0,r=t.dotProduct(i,e);if(r<0&&(e=t.negate(e),r=-r),r>.9999)s=1-n,h=n;else{var o=Math.sqrt(1-r*r),a=Math.atan2(o,r);s=Math.sin((1-n)*a)/o,h=Math.sin(n*a)/o}return new t(i.w*s+e.w*h,i.x*s+e.x*h,i.y*s+e.y*h,i.z*h+e.z*h)}},{key:"fromRotationMatrix",value:function(i){var e=0,n=0,s=0,h=0,r=i.m11+i.m22+i.m33,o=i.m11-i.m22-i.m33,a=i.m22-i.m11-i.m33,m=i.m33-i.m11-i.m22,u=0,l=r;o>l&&(l=o,u=1),a>l&&(l=a,u=2),m>l&&(l=m,u=3);var c=.5*Math.sqrt(l+1),y=.25/c;switch(u){case 0:e=c,n=(i.m23-i.m32)*y,s=(i.m31-i.m13)*y,h=(i.m12-i.m21)*y;break;case 1:e=c,n=(i.m23-i.m32)*y,s=(i.m12+i.m21)*y,h=(i.m31+i.m13)*y;break;case 2:e=c,n=(i.m31-i.m13)*y,s=(i.m12+i.m21)*y,h=(i.m23+i.m32)*y;break;case 3:e=c,n=(i.m12-i.m21)*y,s=(i.m31+i.m13)*y,h=(i.m23+i.m13)*y}return new t(e,n,s,h)}},{key:"setObjectToWorldFromEulerAngles",value:function(i){var e=Math.sin(i.heading/2),n=Math.cos(i.heading/2),s=Math.sin(i.picth/2),h=Math.cos(i.picth/2),r=Math.sin(i.bank/2),o=Math.cos(i.bank/2);return new t(n*h*o+e*s*r,n*s*o+e*h*r,-n*s*r+e*h*o,-e*s*o+n*h*r)}},{key:"setWorldToObjectFromEulerAngles",value:function(i){return t.getConjugate(t.setObjectToWorldFromEulerAngles(i))}}]),t}();a.QuaternionIdentity=new a(1,0,0,0),i.default=a},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),s=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(e(4));var h=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.heading=i,this.picth=e,this.bank=n}return n(t,[{key:"canonize",value:function(){this.picth=s.wrapPi(this.picth),this.picth<-2/Math.PI?(this.picth=-Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI):this.picth>2/Math.PI&&(this.picth=Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI),Math.abs(this.picth)>Math.PI/2-1e-4?(this.heading+=this.bank,this.bank=0):this.bank=s.wrapPi(this.bank),this.heading=s.wrapPi(this.heading)}}],[{key:"fromRotationMatrix",value:function(i){var e=void 0,n=void 0,s=void 0,h=-i.m23;return Math.abs(h)>.9999?(n=Math.PI/2*h,s=0,e=Math.atan2(-i.m31,i.m11)):(n=Math.asin(h),s=Math.atan2(i.m21,i.m22),e=Math.atan2(i.m13,i.m33)),new t(e,n,s)}},{key:"fromObjectToWorldQuaternion",value:function(i){var e=void 0,n=void 0,s=void 0,h=-2*(i.y*i.z-i.w*i.x);return Math.abs(h)>.9999?(n=Math.PI/2*h,s=0,e=Math.atan2(-i.x*i.z+i.w*i.y,.5-i.y*i.y-i.z*i.z)):(n=Math.asin(h),e=Math.atan2(i.x*i.z+i.w*i.y,.5-i.x*i.x-i.y*i.y),s=Math.atan2(i.x*i.y+i.w*i.z,.5-i.x*i.x-i.z*i.z)),new t(e,n,s)}},{key:"fromWorldToObjectQuaternion",value:function(i){var e=void 0,n=void 0,s=void 0,h=-2*(i.y*i.z+i.w*i.x);return Math.abs(h)>.9999?(n=Math.PI/2*h,s=0,e=Math.atan2(-i.x*i.z-i.w*i.y,.5-i.y*i.y-i.z*i.z)):(n=Math.asin(h),e=Math.atan2(i.x*i.z-i.w*i.y,.5-i.x*i.x-i.y*i.y),s=Math.atan2(i.x*i.y-i.w*i.z,.5-i.x*i.x-i.z*i.z)),new t(e,n,s)}}]),t}();i.default=h},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Matrix4=i.Quaternion=i.RotationMatrix=i.Matrix4x3=i.EulerAngles=i.Vector3=void 0;var n=m(e(1)),s=m(e(6)),h=m(e(3)),r=m(e(0)),o=m(e(5)),a=m(e(2));function m(t){return t&&t.__esModule?t:{default:t}}i.Vector3=n.default,i.EulerAngles=s.default,i.Matrix4x3=r.default,i.RotationMatrix=h.default,i.Quaternion=o.default,i.Matrix4=a.default}])});