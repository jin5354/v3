!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("v3",[],i):"object"==typeof exports?exports.v3=i():t.v3=i()}(window,function(){return function(t){var i={};function s(n){if(i[n])return i[n].exports;var e=i[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,s),e.l=!0,e.exports}return s.m=t,s.c=i,s.d=function(t,i,n){s.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=6)}([function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,i,s){this.x=0,this.y=0,this.z=0,this.x=t,this.y=i,this.z=s}return t.isEqual=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z},t.negate=function(i){return new t(-i.x,-i.y,-i.z)},t.plus=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return 2===i.length?new t(i[0].x+i[1].x,i[0].y+i[1].y,i[0].z+i[1].z):new t(i.map(function(t){return t.x}).reduce(function(t,i){return t+i},0),i.map(function(t){return t.y}).reduce(function(t,i){return t+i},0),i.map(function(t){return t.z}).reduce(function(t,i){return t+i},0))},t.scalarMultiply=function(i,s){return new t(i*s.x,i*s.y,i*s.z)},t.getNorm=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},t.getDistance=function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z))},t.dotProduct=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},t.getAngle=function(i,s){return Math.acos(t.dotProduct(i,s)/(t.getNorm(i)*t.getNorm(s)))},t.crossProduct=function(i,s){return new t(i.y*s.z-i.z*s.y,i.z*s.x-i.x*s.z,i.x*s.y-i.y*s.x)},t.prototype.normalize=function(){var i=t.getNorm(this);i&&(this.x=this.x/i,this.y=this.y/i,this.z=this.z/i)},t}();i.default=n},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=s(0),e=s(2),h=function(){function t(t,i,s,n,e,h,r,o,m,a,u,c){this.m11=0,this.m12=0,this.m13=0,this.m21=0,this.m22=0,this.m23=0,this.m31=0,this.m32=0,this.m33=0,this.tx=0,this.ty=0,this.tz=0,this.m11=t,this.m12=i,this.m13=s,this.m21=n,this.m22=e,this.m23=h,this.m31=r,this.m32=o,this.m33=m,this.tx=a,this.ty=u,this.tz=c}return t.vector3Multiply=function(t,i){return new n.default(t.x*i.m11+t.y*i.m21+t.z*i.m31+i.tx,t.x*i.m12+t.y*i.m22+t.z*i.m32+i.tx,t.x*i.m13+t.y*i.m23+t.z*i.m33+i.tx)},t.matrix4x3Multiply=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];if(i.length<2)throw Error("矩阵叉乘至少需要两个参数");return i.reduce(function(i,s){return new t(i.m11*s.m11+i.m12*s.m21+i.m13*s.m31,i.m11*s.m12+i.m12*s.m22+i.m13*s.m32,i.m11*s.m13+i.m12*s.m23+i.m13*s.m33,i.m21*s.m11+i.m22*s.m21+i.m23*s.m31,i.m21*s.m12+i.m22*s.m22+i.m23*s.m32,i.m21*s.m13+i.m22*s.m23+i.m23*s.m33,i.m31*s.m11+i.m32*s.m21+i.m33*s.m31,i.m31*s.m12+i.m32*s.m22+i.m33*s.m32,i.m31*s.m13+i.m32*s.m23+i.m33*s.m33,i.tx*s.m11+i.ty*s.m21+i.tz*s.m31+s.tx,i.tx*s.m12+i.ty*s.m22+i.tz*s.m32+s.ty,i.tx*s.m13+i.ty*s.m23+i.tz*s.m33+s.tz)})},t.prototype.identity=function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=0,this.ty=0,this.tz=0},t.prototype.clearTranslation=function(){this.tx=this.ty=this.tz=0},t.prototype.setTranslation=function(t){this.tx=t.x,this.ty=t.y,this.tz=t.z},t.prototype.setupTranslation=function(t){this.identity(),this.setTranslation(t)},t.prototype.setupLocalToParentFromEulerAngle=function(t,i){var s=e.default.fromEulerAngle(i);this.setupLocalToParentFromRotationMatrix(t,s)},t.prototype.setupLocalToParentFromRotationMatrix=function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.tx=t.x,this.ty=t.y,this.tz=t.z},t.prototype.setupParentToLocalFromEulerAngle=function(t,i){var s=e.default.fromEulerAngle(i);this.setupParentToLocalFromRotationMatrix(t,s)},t.prototype.setupParentToLocalFromRotationMatrix=function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.tx=-(t.x*this.m11+t.y*this.m21+t.z*this.m31),this.ty=-(t.x*this.m12+t.y*this.m22+t.z*this.m32),this.tz=-(t.x*this.m13+t.y*this.m23+t.z*this.m33)},t.prototype.setupRotateFromXYZAxis=function(t,i){var s=Math.sin(i),n=Math.cos(i);switch(t){case"x":this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=n,this.m23=s,this.m31=0,this.m32=-s,this.m33=n;break;case"y":this.m11=n,this.m12=0,this.m13=-s,this.m21=0,this.m22=1,this.m23=0,this.m31=s,this.m32=0,this.m33=n;break;case"z":this.m11=n,this.m12=s,this.m13=0,this.m21=-s,this.m22=n,this.m23=0,this.m31=0,this.m32=0,this.m33=1}this.tx=0,this.ty=0,this.tz=0},t.prototype.setupRotateFromVector3=function(t,i){if(Math.abs(n.default.getNorm(t)-1)>.01)throw Error("旋转轴向量应为单位向量!");var s=Math.sin(i),e=Math.cos(i),h=1-e,r=h*t.x,o=h*t.y,m=h*t.z;this.m11=r*t.x+e,this.m12=r*t.y+t.z*s,this.m13=r*t.z-t.y*s,this.m21=o*t.x-t.z*s,this.m22=o*t.y+e,this.m23=o*t.z+t.x*s,this.m31=m*t.x+t.y*s,this.m32=m*t.y-t.x*s,this.m33=m*t.z+e,this.tx=0,this.ty=0,this.tz=0},t.prototype.setupScale=function(t){this.m11=t.x,this.m12=0,this.m13=0,this.m21=0,this.m22=t.y,this.m23=0,this.m31=0,this.m32=0,this.m33=t.z,this.tx=0,this.ty=0,this.tz=0},t.prototype.setupScaleFromAxis=function(t,i){if(Math.abs(n.default.getNorm(t)-1)>.01)throw Error("旋转轴向量应为单位向量!");var s=i-1,e=s*t.x,h=s*t.y,r=s*t.z;this.m11=e*t.x+1,this.m22=h*t.y+1,this.m33=r*t.z+1,this.m12=this.m21=e*t.y,this.m13=this.m31=e*t.z,this.m23=this.m32=h*t.z,this.tx=this.ty=this.tz=0},t.prototype.setupShear=function(t,i,s){switch(t){case"x":this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=i,this.m32=s,this.m33=1;break;case"y":this.m11=1,this.m12=0,this.m13=0,this.m21=i,this.m22=1,this.m23=s,this.m31=0,this.m32=0,this.m33=1;break;case"z":this.m11=1,this.m12=i,this.m13=s,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1}this.tx=this.ty=this.tx=0},t.prototype.setupReflection=function(t){if(Math.abs(n.default.getNorm(t)-1)>.01)throw Error("反射平面法向量应为单位向量!");var i=-2*t.x,s=-2*t.y,e=-2*t.z;this.m11=1+i*t.x,this.m22=1+s*t.y,this.m33=1+e*t.z,this.m12=this.m21=i*t.y,this.m13=this.m31=i*t.z,this.m23=this.m32=s*t.z,this.tx=this.ty=this.tz=0},t}();i.default=h},function(t,i,s){"use strict";var n,e=(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},function(t,i){function s(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)});Object.defineProperty(i,"__esModule",{value:!0});var h=function(t){function i(i,s,n,e,h,r,o,m,a){var u=t.call(this,i,s,n,e,h,r,o,m,a,0,0,0)||this;return u.m11=0,u.m12=0,u.m13=0,u.m21=0,u.m22=0,u.m23=0,u.m31=0,u.m32=0,u.m33=0,u}return e(i,t),i.fromEulerAngle=function(t){var s=Math.sin(t.heading),n=Math.cos(t.heading),e=Math.sin(t.picth),h=Math.cos(t.picth),r=Math.sin(t.bank),o=Math.cos(t.bank);return new i(n*o+s*e*r,-n*r+s*e*o,s*h,r*h,o*h,-e,-s*o+n*e*r,r*s+n*e*o,n*h)},i.fromWorldToObjectQuaternion=function(t){return new i(1-2*t.y*t.y-2*t.z*t.z,2*t.x*t.y+2*t.w*t.z,2*t.x*t.z-2*t.w*t.y,2*t.x*t.y-2*t.w*t.z,1-2*t.x*t.x-2*t.z*t.z,2*t.y*t.z+2*t.w*t.x,2*t.x*t.z+2*t.w*t.y,2*t.y*t.z-2*t.w*t.x,1-2*t.x*t.x-2*t.y*t.y)},i.fromObjectToWorldQuaternion=function(t){return new i(1-2*t.y*t.y-2*t.z*t.z,2*t.x*t.y-2*t.w*t.z,2*t.x*t.z+2*t.w*t.y,2*t.x*t.y+2*t.w*t.z,1-2*t.x*t.x-2*t.z*t.z,2*t.y*t.z-2*t.w*t.x,2*t.x*t.z-2*t.w*t.y,2*t.y*t.z+2*t.w*t.x,1-2*t.x*t.x-2*t.y*t.y)},i}(s(1).default);i.default=h},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.wrapPi=function(t){return t+=Math.PI,t-=2*Math.floor(1*t/2/Math.PI)*Math.PI,t-=Math.PI},i.safeAcos=function(t){return t>=1?0:t<=-1?Math.PI:Math.acos(t)}},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=s(0),e=s(3),h=function(){function t(t,i,s,n){this.w=0,this.x=0,this.y=0,this.z=0,this.w=t,this.x=i,this.y=s,this.z=n}return t.negate=function(i){return new t(-i.w,-i.x,-i.y,-i.z)},t.getNorm=function(t){return Math.sqrt(t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z)},t.getConjugate=function(i){return new t(i.w,-i.x,-i.y,-i.z)},t.dotProduct=function(t,i){return t.w*i.w+t.x*i.x+t.y*i.y+t.z*i.z},t.crossProduct=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];if(i.length<2)throw Error("四元数叉乘至少需要两个参数");return i.reduce(function(i,s){return new t(i.w*s.w-i.x*s.x-i.y*s.y-i.z*s.z,i.w*s.x+i.x*s.w+i.z*s.y-i.y*s.z,i.w*s.y+i.y*s.w+i.x*s.z-i.z*s.x,i.w*s.z+i.z*s.w+i.y*s.x-i.x*s.y)})},t.scalarMultiply=function(i,s){return new t(i*s.w,i*s.x,i*s.y,i*s.z)},t.log=function(i){var s=i.getRotationAngle();return new t(0,s/2*i.x,s/2*i.y,s/2*i.z)},t.pow=function(i,s){if(Math.abs(i.w)>.999)return i;var n=e.safeAcos(i.w),h=n*s,r=Math.sin(h)/Math.sin(n);return new t(Math.cos(n),i.x*r,i.y*r,i.z*r)},t.getAngularDisplacement=function(i,s){return t.crossProduct(t.getConjugate(i),s)},t.slerp=function(i,s,n){var e,h,r=t.dotProduct(i,s);if(r<0&&(s=t.negate(s),r=-r),r>.9999)e=1-n,h=n;else{var o=Math.sqrt(1-r*r),m=Math.atan2(o,r);e=Math.sin((1-n)*m)/o,h=Math.sin(n*m)/o}return new t(i.w*e+s.w*h,i.x*e+s.x*h,i.y*e+s.y*h,i.z*h+s.z*h)},t.fromRotationMatrix=function(i){var s=0,n=0,e=0,h=0,r=i.m11+i.m22+i.m33,o=i.m11-i.m22-i.m33,m=i.m22-i.m11-i.m33,a=i.m33-i.m11-i.m22,u=0,c=r;o>c&&(c=o,u=1),m>c&&(c=m,u=2),a>c&&(c=a,u=3);var y=.5*Math.sqrt(c+1),f=.25/y;switch(u){case 0:s=y,n=(i.m23-i.m32)*f,e=(i.m31-i.m13)*f,h=(i.m12-i.m21)*f;break;case 1:s=y,n=(i.m23-i.m32)*f,e=(i.m12+i.m21)*f,h=(i.m31+i.m13)*f;break;case 2:s=y,n=(i.m31-i.m13)*f,e=(i.m12+i.m21)*f,h=(i.m23+i.m32)*f;break;case 3:s=y,n=(i.m12-i.m21)*f,e=(i.m31+i.m13)*f,h=(i.m23+i.m13)*f}return new t(s,n,e,h)},t.setObjectToWorldFromEulerAngles=function(i){var s=Math.sin(i.heading/2),n=Math.cos(i.heading/2),e=Math.sin(i.picth/2),h=Math.cos(i.picth/2),r=Math.sin(i.bank/2),o=Math.cos(i.bank/2);return new t(n*h*o+s*e*r,n*e*o+s*h*r,-n*e*r+s*h*o,-s*e*o+n*h*r)},t.setWorldToObjectFromEulerAngles=function(i){return t.getConjugate(t.setObjectToWorldFromEulerAngles(i))},t.prototype.setToRotateAboutX=function(t){this.w=Math.cos(t/2),this.x=Math.sin(t/2),this.y=0,this.z=0},t.prototype.setToRotateAboutY=function(t){this.w=Math.cos(t/2),this.x=0,this.y=Math.sin(t/2),this.z=0},t.prototype.setToRotateAboutZ=function(t){this.w=Math.cos(t/2),this.x=0,this.y=0,this.z=Math.sin(t/2)},t.prototype.setToRotateAboutAxis=function(t,i){if(n.default.getNorm(t)-1>=.01)throw Error("构建四元数时，旋转轴向量必须标准化");this.w=Math.cos(i/2),this.x=Math.sin(i/2)*t.x,this.y=Math.sin(i/2)*t.y,this.z=Math.sin(i/2)*t.z},t.prototype.normalize=function(){var i=t.getNorm(this);i?(this.w=this.w/i,this.x=this.x/i,this.y=this.y/i,this.z=this.z/i):(this.w=1,this.x=0,this.y=0,this.z=0)},t.prototype.getRotationAngle=function(){return 2*e.safeAcos(this.w)},t.prototype.getRotationAxis=function(){var t=Math.sqrt(1-this.w*this.w);return t?new n.default(this.x/t,this.y/t,this.z/t):new n.default(1,0,0)},t.QuaternionIdentity=new t(1,0,0,0),t}();i.default=h},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=s(3),e=function(){function t(t,i,s){this.heading=0,this.picth=0,this.bank=0,this.heading=t,this.picth=i,this.bank=s}return t.fromRotationMatrix=function(i){var s,n,e,h=-i.m23;return Math.abs(h)>.9999?(n=Math.PI/2*h,e=0,s=Math.atan2(-i.m31,i.m11)):(n=Math.asin(h),e=Math.atan2(i.m21,i.m22),s=Math.atan2(i.m13,i.m33)),new t(s,n,e)},t.fromObjectToWorldQuaternion=function(i){var s,n,e,h=-2*(i.y*i.z-i.w*i.x);return Math.abs(h)>.9999?(n=Math.PI/2*h,e=0,s=Math.atan2(-i.x*i.z+i.w*i.y,.5-i.y*i.y-i.z*i.z)):(n=Math.asin(h),s=Math.atan2(i.x*i.z+i.w*i.y,.5-i.x*i.x-i.y*i.y),e=Math.atan2(i.x*i.y+i.w*i.z,.5-i.x*i.x-i.z*i.z)),new t(s,n,e)},t.fromWorldToObjectQuaternion=function(i){var s,n,e,h=-2*(i.y*i.z+i.w*i.x);return Math.abs(h)>.9999?(n=Math.PI/2*h,e=0,s=Math.atan2(-i.x*i.z-i.w*i.y,.5-i.y*i.y-i.z*i.z)):(n=Math.asin(h),s=Math.atan2(i.x*i.z-i.w*i.y,.5-i.x*i.x-i.y*i.y),e=Math.atan2(i.x*i.y-i.w*i.z,.5-i.x*i.x-i.z*i.z)),new t(s,n,e)},t.prototype.canonize=function(){this.picth=n.wrapPi(this.picth),this.picth<-2/Math.PI?(this.picth=-Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI):this.picth>2/Math.PI&&(this.picth=Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI),Math.abs(this.picth)>Math.PI/2-1e-4?(this.heading+=this.bank,this.bank=0):this.bank=n.wrapPi(this.bank),this.heading=n.wrapPi(this.heading)},t}();i.default=e},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=s(0);i.Vector3=n.default;var e=s(5);i.EulerAngles=e.default;var h=s(2);i.RotationMatrix=h.default;var r=s(1);i.Matrix4x3=r.default;var o=s(4);i.Quaternion=o.default}])});