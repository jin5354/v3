!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("v3",[],i):"object"==typeof exports?exports.v3=i():t.v3=i()}(window,function(){return function(t){var i={};function m(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,m),h.l=!0,h.exports}return m.m=t,m.c=i,m.d=function(t,i,s){m.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},m.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},m.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return m.d(i,"a",i),i},m.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},m.p="",m(m.s=5)}([function(t,i,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){for(var m=0;m<i.length;m++){var s=i[m];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,m,s){return m&&t(i.prototype,m),s&&t(i,s),i}}();var h=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=m,this.z=s}return s(t,[{key:"normalize",value:function(){var i=t.getNorm(this);i&&(this.x=this.x/i,this.y=this.y/i,this.z=this.z/i)}},{key:"getVec3FloatArray",value:function(){return new Float32Array([this.x,this.y,this.z])}},{key:Symbol.iterator,value:function(){var t=[this.x,this.y,this.z],i=0;return{next:function(){return{done:i===t.length,value:t[i++]}}}}}],[{key:"isEqual",value:function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z}},{key:"negate",value:function(i){return new t(-i.x,-i.y,-i.z)}},{key:"plus",value:function(){for(var i=arguments.length,m=Array(i),s=0;s<i;s++)m[s]=arguments[s];return 2===m.length?new t(m[0].x+m[1].x,m[0].y+m[1].y,m[0].z+m[1].z):new t(m.map(function(t){return t.x}).reduce(function(t,i){return t+i},0),m.map(function(t){return t.y}).reduce(function(t,i){return t+i},0),m.map(function(t){return t.z}).reduce(function(t,i){return t+i},0))}},{key:"scalarMultiply",value:function(i,m){return new t(i*m.x,i*m.y,i*m.z)}},{key:"getNorm",value:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}},{key:"getDistance",value:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z))}},{key:"dotProduct",value:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}},{key:"getAngle",value:function(i,m){return Math.acos(t.dotProduct(i,m)/(t.getNorm(i)*t.getNorm(m)))}},{key:"crossProduct",value:function(i,m){return new t(i.y*m.z-i.z*m.y,i.z*m.x-i.x*m.z,i.x*m.y-i.y*m.x)}},{key:"vector3Multiply",value:function(i,m){var s=i.x*m.m14+i.y*m.m24+i.z*m.m34+m.tw;if(0===s)throw Error("Vector3 W = 0 ERROR!");return new t((i.x*m.m11+i.y*m.m21+i.z*m.m31+m.tx)/s,(i.x*m.m12+i.y*m.m22+i.z*m.m32+m.ty)/s,(i.x*m.m13+i.y*m.m23+i.z*m.m33+m.tz)/s)}}]),t}();i.default=h},function(t,i,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.wrapPi=function(t){return t+=Math.PI,t-=2*Math.floor(1*t/2/Math.PI)*Math.PI,t-=Math.PI},i.safeAcos=function(t){if(t>=1)return 0;if(t<=-1)return Math.PI;return Math.acos(t)}},function(t,i,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s,h=function(){function t(t,i){for(var m=0;m<i.length;m++){var s=i[m];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,m,s){return m&&t(i.prototype,m),s&&t(i,s),i}}(),e=m(0),n=(s=e)&&s.__esModule?s:{default:s};function r(t){if(Array.isArray(t)){for(var i=0,m=Array(t.length);i<t.length;i++)m[i]=t[i];return m}return Array.from(t)}var a=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,x=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.m11=i,this.m12=m,this.m13=s,this.m14=h,this.m21=e,this.m22=n,this.m23=r,this.m24=a,this.m31=o,this.m32=u,this.m33=l,this.m34=y,this.tx=c,this.ty=f,this.tz=x,this.tw=v}return h(t,[{key:"scalarMultiply",value:function(i){this.cloneFrom(t.scalarMultiply(i,this))}},{key:"matrix4Multiply",value:function(){for(var i=arguments.length,m=Array(i),s=0;s<i;s++)m[s]=arguments[s];this.cloneFrom(t.matrix4Multiply.apply(t,[this].concat(m)))}},{key:"identity",value:function(){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.tx=0,this.ty=0,this.tz=0,this.tw=1}},{key:"clearTranslation",value:function(){this.tx=this.ty=this.tz=0}},{key:"setTranslation",value:function(i){var m=new t(1,0,0,0,0,1,0,0,0,0,1,0,i.x,i.y,i.z,1);this.matrix4Multiply(m)}},{key:"setLocalToParentFromEulerAngle",value:function(i,m){var s=t.fromEulerAngle(m);this.setLocalToParentFromRotationMatrix(i,s)}},{key:"setLocalToParentFromRotationMatrix",value:function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m14=i.m14,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m24=i.m24,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.m34=i.m34,this.tx=t.x,this.ty=t.y,this.tz=t.z,this.tw=i.tw}},{key:"setParentToLocalFromEulerAngle",value:function(i,m){var s=t.fromEulerAngle(m);this.setParentToLocalFromRotationMatrix(i,s)}},{key:"setParentToLocalFromRotationMatrix",value:function(t,i){this.m11=i.m11,this.m12=i.m12,this.m13=i.m13,this.m14=i.m14,this.m21=i.m21,this.m22=i.m22,this.m23=i.m23,this.m24=i.m24,this.m31=i.m31,this.m32=i.m32,this.m33=i.m33,this.m34=i.m34,this.tx=-(t.x*this.m11+t.y*this.m21+t.z*this.m31),this.ty=-(t.x*this.m12+t.y*this.m22+t.z*this.m32),this.tz=-(t.x*this.m13+t.y*this.m23+t.z*this.m33),this.tw=i.tw}},{key:"setRotateFromXYZAxis",value:function(i,m){var s=Math.sin(m),h=Math.cos(m),e=new t;switch(i){case"x":case"X":e.m11=1,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=h,e.m23=s,e.m24=0,e.m31=0,e.m32=-s,e.m33=h,e.m34=0;break;case"y":case"Y":e.m11=h,e.m12=0,e.m13=-s,e.m14=0,e.m21=0,e.m22=1,e.m23=0,e.m24=0,e.m31=s,e.m32=0,e.m33=h,e.m34=0;break;case"z":case"Z":e.m11=h,e.m12=s,e.m13=0,e.m14=0,e.m21=-s,e.m22=h,e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=1,e.m34=0}e.tx=0,e.ty=0,e.tz=0,e.tw=1,this.matrix4Multiply(e)}},{key:"setRotateFromVector3",value:function(i,m){if(Math.abs(n.default.getNorm(i)-1)>.01)throw Error("旋转轴向量应为单位向量!");var s=Math.sin(m),h=Math.cos(m),e=1-h,r=e*i.x,a=e*i.y,o=e*i.z,u=new t;u.m11=r*i.x+h,u.m12=r*i.y+i.z*s,u.m13=r*i.z-i.y*s,u.m14=0,u.m21=a*i.x-i.z*s,u.m22=a*i.y+h,u.m23=a*i.z+i.x*s,u.m24=0,u.m31=o*i.x+i.y*s,u.m32=o*i.y-i.x*s,u.m33=o*i.z+h,u.m34=0,u.tx=0,u.ty=0,u.tz=0,u.tw=1,this.matrix4Multiply(u)}},{key:"setScale",value:function(i){var m=new t;m.m11=i.x,m.m12=0,m.m13=0,m.m21=0,m.m22=i.y,m.m23=0,m.m31=0,m.m32=0,m.m33=i.z,m.tx=0,m.ty=0,m.tz=0,m.m14=m.m24=m.m34=0,m.tw=1,this.matrix4Multiply(m)}},{key:"setScaleFromAxis",value:function(i,m){if(Math.abs(n.default.getNorm(i)-1)>.01)throw Error("旋转轴向量应为单位向量!");var s=m-1,h=s*i.x,e=s*i.y,r=s*i.z,a=new t;a.m11=h*i.x+1,a.m22=e*i.y+1,a.m33=r*i.z+1,a.m12=a.m21=h*i.y,a.m13=a.m31=h*i.z,a.m23=a.m32=e*i.z,a.tx=a.ty=a.tz=0,a.m14=a.m24=a.m34=0,a.tw=1,this.matrix4Multiply(a)}},{key:"setShear",value:function(i,m,s){var h=new t;switch(i){case"x":case"X":h.m11=1,h.m12=0,h.m13=0,h.m21=0,h.m22=1,h.m23=0,h.m31=m,h.m32=s,h.m33=1;break;case"y":case"Y":h.m11=1,h.m12=0,h.m13=0,h.m21=m,h.m22=1,h.m23=s,h.m31=0,h.m32=0,h.m33=1;break;case"z":case"Z":h.m11=1,h.m12=m,h.m13=s,h.m21=0,h.m22=1,h.m23=0,h.m31=0,h.m32=0,h.m33=1}h.tx=h.ty=h.tx=0,h.m14=h.m24=h.m34=0,h.tw=1,this.matrix4Multiply(h)}},{key:"setReflection",value:function(i){if(Math.abs(n.default.getNorm(i)-1)>.01)throw Error("反射平面法向量应为单位向量!");var m=-2*i.x,s=-2*i.y,h=-2*i.z,e=new t;e.m11=1+m*i.x,e.m22=1+s*i.y,e.m33=1+h*i.z,e.m12=e.m21=m*i.y,e.m13=e.m31=m*i.z,e.m23=e.m32=s*i.z,e.tx=e.ty=e.tz=0,e.m14=e.m24=e.m34=0,e.tw=1,this.matrix4Multiply(e)}},{key:"inverse",value:function(){var i=new t,m=void 0;i.m11=this.m22*this.m33*this.tw-this.m22*this.m34*this.tz-this.m32*this.m23*this.tw+this.m32*this.m24*this.tz+this.ty*this.m23*this.m34-this.ty*this.m24*this.m33,i.m21=-this.m21*this.m33*this.tw+this.m21*this.m34*this.tz+this.m31*this.m23*this.tw-this.m31*this.m24*this.tz-this.tx*this.m23*this.m34+this.tx*this.m24*this.m33,i.m31=this.m21*this.m32*this.tw-this.m21*this.m34*this.ty-this.m31*this.m22*this.tw+this.m31*this.m24*this.ty+this.tx*this.m22*this.m34-this.tx*this.m24*this.m32,i.tx=-this.m21*this.m32*this.tz+this.m21*this.m33*this.ty+this.m31*this.m22*this.tz-this.m31*this.m23*this.ty-this.tx*this.m22*this.m33+this.tx*this.m23*this.m32,i.m12=-this.m12*this.m33*this.tw+this.m12*this.m34*this.tz+this.m32*this.m13*this.tw-this.m32*this.m14*this.tz-this.ty*this.m13*this.m34+this.ty*this.m14*this.m33,i.m22=this.m11*this.m33*this.tw-this.m11*this.m34*this.tz-this.m31*this.m13*this.tw+this.m31*this.m14*this.tz+this.tx*this.m13*this.m34-this.tx*this.m14*this.m33,i.m32=-this.m11*this.m32*this.tw+this.m11*this.m34*this.ty+this.m31*this.m12*this.tw-this.m31*this.m14*this.ty-this.tx*this.m12*this.m34+this.tx*this.m14*this.m32,i.ty=this.m11*this.m32*this.tz-this.m11*this.m33*this.ty-this.m31*this.m12*this.tz+this.m31*this.m13*this.ty+this.tx*this.m12*this.m33-this.tx*this.m13*this.m32,i.m13=this.m12*this.m23*this.tw-this.m12*this.m24*this.tz-this.m22*this.m13*this.tw+this.m22*this.m14*this.tz+this.ty*this.m13*this.m24-this.ty*this.m14*this.m23,i.m23=-this.m11*this.m23*this.tw+this.m11*this.m24*this.tz+this.m21*this.m13*this.tw-this.m21*this.m14*this.tz-this.tx*this.m13*this.m24+this.tx*this.m14*this.m23,i.m33=this.m11*this.m22*this.tw-this.m11*this.m24*this.ty-this.m21*this.m12*this.tw+this.m21*this.m14*this.ty+this.tx*this.m12*this.m24-this.tx*this.m14*this.m22,i.tz=-this.m11*this.m22*this.tz+this.m11*this.m23*this.ty+this.m21*this.m12*this.tz-this.m21*this.m13*this.ty-this.tx*this.m12*this.m23+this.tx*this.m13*this.m22,i.m14=-this.m12*this.m23*this.m34+this.m12*this.m24*this.m33+this.m22*this.m13*this.m34-this.m22*this.m14*this.m33-this.m32*this.m13*this.m24+this.m32*this.m14*this.m23,i.m24=this.m11*this.m23*this.m34-this.m11*this.m24*this.m33-this.m21*this.m13*this.m34+this.m21*this.m14*this.m33+this.m31*this.m13*this.m24-this.m31*this.m14*this.m23,i.m34=-this.m11*this.m22*this.m34+this.m11*this.m24*this.m32+this.m21*this.m12*this.m34-this.m21*this.m14*this.m32-this.m31*this.m12*this.m24+this.m31*this.m14*this.m22,i.tw=this.m11*this.m22*this.m33-this.m11*this.m23*this.m32-this.m21*this.m12*this.m33+this.m21*this.m13*this.m32+this.m31*this.m12*this.m23-this.m31*this.m13*this.m22,0!==(m=this.m11*i.m11+this.m12*i.m21+this.m13*i.m31+this.m14*i.tx)?(m=1/m,i.scalarMultiply(m),this.cloneFrom(i)):this.cloneFrom(i)}},{key:"transpose",value:function(){var t=[this.m11,this.m21,this.m31,this.tx,this.m12,this.m22,this.m32,this.ty,this.m13,this.m23,this.m33,this.tz,this.m14,this.m24,this.m34,this.tw];this.m11=t[0],this.m12=t[1],this.m13=t[2],this.m14=t[3],this.m21=t[4],this.m22=t[5],this.m23=t[6],this.m24=t[7],this.m31=t[8],this.m32=t[9],this.m33=t[10],this.m34=t[11],this.tx=t[12],this.ty=t[13],this.tz=t[14],this.tw=t[15]}},{key:"getMat4FloatArray",value:function(){return new Float32Array([this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.tx,this.ty,this.tz,this.tw])}},{key:"setLookAt",value:function(i,m,s){var h=n.default.plus(i,n.default.negate(m));h.normalize(),s.normalize();var e=n.default.crossProduct(s,h);e.normalize();var a=n.default.crossProduct(e,h);a.normalize();var o=new(Function.prototype.bind.apply(t,[null].concat(r(e),[0],r(a),[0],r(h),[0,0,0,0,1]))),u=new t;u.setTranslation(i);var l=t.matrix4Multiply(o,u);l.inverse(),this.matrix4Multiply(l)}},{key:"setOrtho",value:function(i,m,s,h,e,n){var r=new t;r.m11=2/(m-i),r.m12=0,r.m13=0,r.m14=0,r.m21=0,r.m22=2/(h-s),r.m23=0,r.m24=0,r.m31=0,r.m32=0,r.m33=-2/(n-e),r.m34=0,r.tx=-(m+i)/(m-i),r.ty=-(h+s)/(h-s),r.tz=-(n+e)/(n-e),r.tw=1,this.matrix4Multiply(r)}},{key:"setPerspective",value:function(i,m,s,h){var e=new t,n=Math.tan(Math.PI/2-i/2),r=1/(s-h);e.m11=n/m,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=n,e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=r*(s+h),e.m34=-1,e.tx=0,e.ty=0,e.tz=2*s*h*r,e.tw=0,this.matrix4Multiply(e)}},{key:"cloneFrom",value:function(t){this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m21=t.m21,this.m22=t.m22,this.m23=t.m23,this.m24=t.m24,this.m31=t.m31,this.m32=t.m32,this.m33=t.m33,this.m34=t.m34,this.tx=t.tx,this.ty=t.ty,this.tz=t.tz,this.tw=t.tw}},{key:Symbol.iterator,value:function(){var t=[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.tx,this.ty,this.tz,this.tw],i=0;return{next:function(){return{done:i===t.length,value:t[i++]}}}}}],[{key:"scalarMultiply",value:function(i,m){return new t(m.m11*i,m.m12*i,m.m13*i,m.m14*i,m.m21*i,m.m22*i,m.m23*i,m.m24*i,m.m31*i,m.m32*i,m.m33*i,m.m34*i,m.tx*i,m.ty*i,m.tz*i,m.tw*i)}},{key:"fromEulerAngle",value:function(i){var m=Math.sin(i.heading),s=Math.cos(i.heading),h=Math.sin(i.picth),e=Math.cos(i.picth),n=Math.sin(i.bank),r=Math.cos(i.bank);return new t(s*r+m*h*n,-s*n+m*h*r,m*e,0,n*e,r*e,-h,0,-m*r+s*h*n,n*m+s*h*r,s*e,0,0,0,0,1)}},{key:"fromWorldToObjectQuaternion",value:function(i){return new t(1-2*i.y*i.y-2*i.z*i.z,2*i.x*i.y+2*i.w*i.z,2*i.x*i.z-2*i.w*i.y,0,2*i.x*i.y-2*i.w*i.z,1-2*i.x*i.x-2*i.z*i.z,2*i.y*i.z+2*i.w*i.x,0,2*i.x*i.z+2*i.w*i.y,2*i.y*i.z-2*i.w*i.x,1-2*i.x*i.x-2*i.y*i.y,0,0,0,0,1)}},{key:"fromObjectToWorldQuaternion",value:function(i){return new t(1-2*i.y*i.y-2*i.z*i.z,2*i.x*i.y-2*i.w*i.z,2*i.x*i.z+2*i.w*i.y,0,2*i.x*i.y+2*i.w*i.z,1-2*i.x*i.x-2*i.z*i.z,2*i.y*i.z-2*i.w*i.x,0,2*i.x*i.z-2*i.w*i.y,2*i.y*i.z+2*i.w*i.x,1-2*i.x*i.x-2*i.y*i.y,0,0,0,0,1)}},{key:"matrix4Multiply",value:function(){for(var i=arguments.length,m=Array(i),s=0;s<i;s++)m[s]=arguments[s];if(m.length<2)throw Error("矩阵叉乘至少需要两个参数");return m.reduce(function(i,m){return new t(i.m11*m.m11+i.m12*m.m21+i.m13*m.m31+i.m14*m.tx,i.m11*m.m12+i.m12*m.m22+i.m13*m.m32+i.m14*m.ty,i.m11*m.m13+i.m12*m.m23+i.m13*m.m33+i.m14*m.tz,i.m11*m.m14+i.m12*m.m24+i.m13*m.m34+i.m14*m.tw,i.m21*m.m11+i.m22*m.m21+i.m23*m.m31+i.m24*m.tx,i.m21*m.m12+i.m22*m.m22+i.m23*m.m32+i.m24*m.ty,i.m21*m.m13+i.m22*m.m23+i.m23*m.m33+i.m24*m.tz,i.m21*m.m14+i.m22*m.m24+i.m23*m.m34+i.m24*m.tw,i.m31*m.m11+i.m32*m.m21+i.m33*m.m31+i.m34*m.tx,i.m31*m.m12+i.m32*m.m22+i.m33*m.m32+i.m34*m.ty,i.m31*m.m13+i.m32*m.m23+i.m33*m.m33+i.m34*m.tz,i.m31*m.m14+i.m32*m.m24+i.m33*m.m34+i.m34*m.tw,i.tx*m.m11+i.ty*m.m21+i.tz*m.m31+i.tw*m.tx,i.tx*m.m12+i.ty*m.m22+i.tz*m.m32+i.tw*m.ty,i.tx*m.m13+i.ty*m.m23+i.tz*m.m33+i.tw*m.tz,i.tx*m.m14+i.ty*m.m24+i.tz*m.m34+i.tw*m.tw)})}}]),t}();i.default=a},function(t,i,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s,h=function(){function t(t,i){for(var m=0;m<i.length;m++){var s=i[m];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,m,s){return m&&t(i.prototype,m),s&&t(i,s),i}}(),e=m(0),n=(s=e)&&s.__esModule?s:{default:s},r=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&(i[m]=t[m]);return i.default=t,i}(m(1));var a=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=i,this.x=m,this.y=s,this.z=h}return h(t,[{key:"setToRotateAboutX",value:function(t){this.w=Math.cos(t/2),this.x=Math.sin(t/2),this.y=0,this.z=0}},{key:"setToRotateAboutY",value:function(t){this.w=Math.cos(t/2),this.x=0,this.y=Math.sin(t/2),this.z=0}},{key:"setToRotateAboutZ",value:function(t){this.w=Math.cos(t/2),this.x=0,this.y=0,this.z=Math.sin(t/2)}},{key:"setToRotateAboutAxis",value:function(t,i){if(n.default.getNorm(t)-1>=.01)throw Error("构建四元数时，旋转轴向量必须标准化");this.w=Math.cos(i/2),this.x=Math.sin(i/2)*t.x,this.y=Math.sin(i/2)*t.y,this.z=Math.sin(i/2)*t.z}},{key:"normalize",value:function(){var i=t.getNorm(this);i?(this.w=this.w/i,this.x=this.x/i,this.y=this.y/i,this.z=this.z/i):(this.w=1,this.x=0,this.y=0,this.z=0)}},{key:"getRotationAngle",value:function(){return 2*r.safeAcos(this.w)}},{key:"getRotationAxis",value:function(){var t=Math.sqrt(1-this.w*this.w);return t?new n.default(this.x/t,this.y/t,this.z/t):new n.default(1,0,0)}}],[{key:"negate",value:function(i){return new t(-i.w,-i.x,-i.y,-i.z)}},{key:"getNorm",value:function(t){return Math.sqrt(t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z)}},{key:"getConjugate",value:function(i){return new t(i.w,-i.x,-i.y,-i.z)}},{key:"dotProduct",value:function(t,i){return t.w*i.w+t.x*i.x+t.y*i.y+t.z*i.z}},{key:"crossProduct",value:function(){for(var i=arguments.length,m=Array(i),s=0;s<i;s++)m[s]=arguments[s];if(m.length<2)throw Error("四元数叉乘至少需要两个参数");return m.reduce(function(i,m){return new t(i.w*m.w-i.x*m.x-i.y*m.y-i.z*m.z,i.w*m.x+i.x*m.w+i.z*m.y-i.y*m.z,i.w*m.y+i.y*m.w+i.x*m.z-i.z*m.x,i.w*m.z+i.z*m.w+i.y*m.x-i.x*m.y)})}},{key:"scalarMultiply",value:function(i,m){return new t(i*m.w,i*m.x,i*m.y,i*m.z)}},{key:"log",value:function(i){var m=i.getRotationAngle();return new t(0,m/2*i.x,m/2*i.y,m/2*i.z)}},{key:"pow",value:function(i,m){if(Math.abs(i.w)>.999)return i;var s=r.safeAcos(i.w),h=s*m,e=Math.sin(h)/Math.sin(s);return new t(Math.cos(s),i.x*e,i.y*e,i.z*e)}},{key:"getAngularDisplacement",value:function(i,m){return t.crossProduct(t.getConjugate(i),m)}},{key:"slerp",value:function(i,m,s){var h=void 0,e=void 0,n=t.dotProduct(i,m);if(n<0&&(m=t.negate(m),n=-n),n>.9999)h=1-s,e=s;else{var r=Math.sqrt(1-n*n),a=Math.atan2(r,n);h=Math.sin((1-s)*a)/r,e=Math.sin(s*a)/r}return new t(i.w*h+m.w*e,i.x*h+m.x*e,i.y*h+m.y*e,i.z*e+m.z*e)}},{key:"fromRotationMatrix",value:function(i){var m=0,s=0,h=0,e=0,n=i.m11+i.m22+i.m33,r=i.m11-i.m22-i.m33,a=i.m22-i.m11-i.m33,o=i.m33-i.m11-i.m22,u=0,l=n;r>l&&(l=r,u=1),a>l&&(l=a,u=2),o>l&&(l=o,u=3);var y=.5*Math.sqrt(l+1),c=.25/y;switch(u){case 0:m=y,s=(i.m23-i.m32)*c,h=(i.m31-i.m13)*c,e=(i.m12-i.m21)*c;break;case 1:m=y,s=(i.m23-i.m32)*c,h=(i.m12+i.m21)*c,e=(i.m31+i.m13)*c;break;case 2:m=y,s=(i.m31-i.m13)*c,h=(i.m12+i.m21)*c,e=(i.m23+i.m32)*c;break;case 3:m=y,s=(i.m12-i.m21)*c,h=(i.m31+i.m13)*c,e=(i.m23+i.m13)*c}return new t(m,s,h,e)}},{key:"setObjectToWorldFromEulerAngles",value:function(i){var m=Math.sin(i.heading/2),s=Math.cos(i.heading/2),h=Math.sin(i.picth/2),e=Math.cos(i.picth/2),n=Math.sin(i.bank/2),r=Math.cos(i.bank/2);return new t(s*e*r+m*h*n,s*h*r+m*e*n,-s*h*n+m*e*r,-m*h*r+s*e*n)}},{key:"setWorldToObjectFromEulerAngles",value:function(i){return t.getConjugate(t.setObjectToWorldFromEulerAngles(i))}}]),t}();a.QuaternionIdentity=new a(1,0,0,0),i.default=a},function(t,i,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){for(var m=0;m<i.length;m++){var s=i[m];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,m,s){return m&&t(i.prototype,m),s&&t(i,s),i}}(),h=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&(i[m]=t[m]);return i.default=t,i}(m(1));var e=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.heading=i,this.picth=m,this.bank=s}return s(t,[{key:"canonize",value:function(){this.picth=h.wrapPi(this.picth),this.picth<-2/Math.PI?(this.picth=-Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI):this.picth>2/Math.PI&&(this.picth=Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI),Math.abs(this.picth)>Math.PI/2-1e-4?(this.heading+=this.bank,this.bank=0):this.bank=h.wrapPi(this.bank),this.heading=h.wrapPi(this.heading)}}],[{key:"fromRotationMatrix",value:function(i){var m=void 0,s=void 0,h=void 0,e=-i.m23;return Math.abs(e)>.9999?(s=Math.PI/2*e,h=0,m=Math.atan2(-i.m31,i.m11)):(s=Math.asin(e),h=Math.atan2(i.m21,i.m22),m=Math.atan2(i.m13,i.m33)),new t(m,s,h)}},{key:"fromObjectToWorldQuaternion",value:function(i){var m=void 0,s=void 0,h=void 0,e=-2*(i.y*i.z-i.w*i.x);return Math.abs(e)>.9999?(s=Math.PI/2*e,h=0,m=Math.atan2(-i.x*i.z+i.w*i.y,.5-i.y*i.y-i.z*i.z)):(s=Math.asin(e),m=Math.atan2(i.x*i.z+i.w*i.y,.5-i.x*i.x-i.y*i.y),h=Math.atan2(i.x*i.y+i.w*i.z,.5-i.x*i.x-i.z*i.z)),new t(m,s,h)}},{key:"fromWorldToObjectQuaternion",value:function(i){var m=void 0,s=void 0,h=void 0,e=-2*(i.y*i.z+i.w*i.x);return Math.abs(e)>.9999?(s=Math.PI/2*e,h=0,m=Math.atan2(-i.x*i.z-i.w*i.y,.5-i.y*i.y-i.z*i.z)):(s=Math.asin(e),m=Math.atan2(i.x*i.z-i.w*i.y,.5-i.x*i.x-i.y*i.y),h=Math.atan2(i.x*i.y-i.w*i.z,.5-i.x*i.x-i.z*i.z)),new t(m,s,h)}}]),t}();i.default=e},function(t,i,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Matrix4=i.Quaternion=i.EulerAngles=i.Vector3=void 0;var s=r(m(0)),h=r(m(4)),e=r(m(3)),n=r(m(2));function r(t){return t&&t.__esModule?t:{default:t}}i.Vector3=s.default,i.EulerAngles=h.default,i.Quaternion=e.default,i.Matrix4=n.default}])});