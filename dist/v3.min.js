!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("v3",[],e):"object"==typeof exports?exports.v3=e():t.v3=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var r=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=0,this.y=0,this.z=0,this.x=e,this.y=i,this.z=n}return n(t,[{key:"normalize",value:function(){var e=t.getNorm(this);e&&(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e)}},{key:Symbol.iterator,value:function(){var t=[this.x,this.y,this.z],e=0;return{next:function(){return{done:e===t.length,value:t[e++]}}}}}],[{key:"isEqual",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}},{key:"negate",value:function(e){return new t(-e.x,-e.y,-e.z)}},{key:"plus",value:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return 2===i.length?new t(i[0].x+i[1].x,i[0].y+i[1].y,i[0].z+i[1].z):new t(i.map(function(t){return t.x}).reduce(function(t,e){return t+e},0),i.map(function(t){return t.y}).reduce(function(t,e){return t+e},0),i.map(function(t){return t.z}).reduce(function(t,e){return t+e},0))}},{key:"scalarMultiply",value:function(e,i){return new t(e*i.x,e*i.y,e*i.z)}},{key:"getNorm",value:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}},{key:"getDistance",value:function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))}},{key:"dotProduct",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"getAngle",value:function(e,i){return Math.acos(t.dotProduct(e,i)/(t.getNorm(e)*t.getNorm(i)))}},{key:"crossProduct",value:function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)}}]),t}();e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=a(i(0)),s=a(i(2));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,i,n,r,s,a,o,h,u,m,c,l){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m11=0,this.m12=0,this.m13=0,this.m21=0,this.m22=0,this.m23=0,this.m31=0,this.m32=0,this.m33=0,this.tx=0,this.ty=0,this.tz=0,this.m11=e,this.m12=i,this.m13=n,this.m21=r,this.m22=s,this.m23=a,this.m31=o,this.m32=h,this.m33=u,this.tx=m,this.ty=c,this.tz=l}return n(t,[{key:"identity",value:function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1,this.tx=0,this.ty=0,this.tz=0}},{key:"clearTranslation",value:function(){this.tx=this.ty=this.tz=0}},{key:"setTranslation",value:function(t){this.tx=t.x,this.ty=t.y,this.tz=t.z}},{key:"setupTranslation",value:function(t){this.identity(),this.setTranslation(t)}},{key:"setupLocalToParentFromEulerAngle",value:function(t,e){var i=s.default.fromEulerAngle(e);this.setupLocalToParentFromRotationMatrix(t,i)}},{key:"setupLocalToParentFromRotationMatrix",value:function(t,e){this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m21=e.m21,this.m22=e.m22,this.m23=e.m23,this.m31=e.m31,this.m32=e.m32,this.m33=e.m33,this.tx=t.x,this.ty=t.y,this.tz=t.z}},{key:"setupParentToLocalFromEulerAngle",value:function(t,e){var i=s.default.fromEulerAngle(e);this.setupParentToLocalFromRotationMatrix(t,i)}},{key:"setupParentToLocalFromRotationMatrix",value:function(t,e){this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m21=e.m21,this.m22=e.m22,this.m23=e.m23,this.m31=e.m31,this.m32=e.m32,this.m33=e.m33,this.tx=-(t.x*this.m11+t.y*this.m21+t.z*this.m31),this.ty=-(t.x*this.m12+t.y*this.m22+t.z*this.m32),this.tz=-(t.x*this.m13+t.y*this.m23+t.z*this.m33)}},{key:"setupRotateFromXYZAxis",value:function(t,e){var i=Math.sin(e),n=Math.cos(e);switch(t){case"x":this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=n,this.m23=i,this.m31=0,this.m32=-i,this.m33=n;break;case"y":this.m11=n,this.m12=0,this.m13=-i,this.m21=0,this.m22=1,this.m23=0,this.m31=i,this.m32=0,this.m33=n;break;case"z":this.m11=n,this.m12=i,this.m13=0,this.m21=-i,this.m22=n,this.m23=0,this.m31=0,this.m32=0,this.m33=1}this.tx=0,this.ty=0,this.tz=0}},{key:"setupRotateFromVector3",value:function(t,e){if(Math.abs(r.default.getNorm(t)-1)>.01)throw Error("旋转轴向量应为单位向量!");var i=Math.sin(e),n=Math.cos(e),s=1-n,a=s*t.x,o=s*t.y,h=s*t.z;this.m11=a*t.x+n,this.m12=a*t.y+t.z*i,this.m13=a*t.z-t.y*i,this.m21=o*t.x-t.z*i,this.m22=o*t.y+n,this.m23=o*t.z+t.x*i,this.m31=h*t.x+t.y*i,this.m32=h*t.y-t.x*i,this.m33=h*t.z+n,this.tx=0,this.ty=0,this.tz=0}},{key:"setupScale",value:function(t){this.m11=t.x,this.m12=0,this.m13=0,this.m21=0,this.m22=t.y,this.m23=0,this.m31=0,this.m32=0,this.m33=t.z,this.tx=0,this.ty=0,this.tz=0}},{key:"setupScaleFromAxis",value:function(t,e){if(Math.abs(r.default.getNorm(t)-1)>.01)throw Error("旋转轴向量应为单位向量!");var i=e-1,n=i*t.x,s=i*t.y,a=i*t.z;this.m11=n*t.x+1,this.m22=s*t.y+1,this.m33=a*t.z+1,this.m12=this.m21=n*t.y,this.m13=this.m31=n*t.z,this.m23=this.m32=s*t.z,this.tx=this.ty=this.tz=0}},{key:"setupShear",value:function(t,e,i){switch(t){case"x":this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=e,this.m32=i,this.m33=1;break;case"y":this.m11=1,this.m12=0,this.m13=0,this.m21=e,this.m22=1,this.m23=i,this.m31=0,this.m32=0,this.m33=1;break;case"z":this.m11=1,this.m12=e,this.m13=i,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1}this.tx=this.ty=this.tx=0}},{key:"setupReflection",value:function(t){if(Math.abs(r.default.getNorm(t)-1)>.01)throw Error("反射平面法向量应为单位向量!");var e=-2*t.x,i=-2*t.y,n=-2*t.z;this.m11=1+e*t.x,this.m22=1+i*t.y,this.m33=1+n*t.z,this.m12=this.m21=e*t.y,this.m13=this.m31=e*t.z,this.m23=this.m32=i*t.z,this.tx=this.ty=this.tz=0}}],[{key:"vector3Multiply",value:function(t,e){return new r.default(t.x*e.m11+t.y*e.m21+t.z*e.m31+e.tx,t.x*e.m12+t.y*e.m22+t.z*e.m32+e.tx,t.x*e.m13+t.y*e.m23+t.z*e.m33+e.tx)}},{key:"matrix4x3Multiply",value:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];if(i.length<2)throw Error("矩阵叉乘至少需要两个参数");return i.reduce(function(e,i){return new t(e.m11*i.m11+e.m12*i.m21+e.m13*i.m31,e.m11*i.m12+e.m12*i.m22+e.m13*i.m32,e.m11*i.m13+e.m12*i.m23+e.m13*i.m33,e.m21*i.m11+e.m22*i.m21+e.m23*i.m31,e.m21*i.m12+e.m22*i.m22+e.m23*i.m32,e.m21*i.m13+e.m22*i.m23+e.m23*i.m33,e.m31*i.m11+e.m32*i.m21+e.m33*i.m31,e.m31*i.m12+e.m32*i.m22+e.m33*i.m32,e.m31*i.m13+e.m32*i.m23+e.m33*i.m33,e.tx*i.m11+e.ty*i.m21+e.tz*i.m31+i.tx,e.tx*i.m12+e.ty*i.m22+e.tz*i.m32+i.ty,e.tx*i.m13+e.ty*i.m23+e.tz*i.m33+i.tz)})}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),a=(n=s)&&n.__esModule?n:{default:n};var o=function(t){function e(t,i,n,r,s,a,o,h,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var m=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n,r,s,a,o,h,u,0,0,0));return m.m11=0,m.m12=0,m.m13=0,m.m21=0,m.m22=0,m.m23=0,m.m31=0,m.m32=0,m.m33=0,m}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),r(e,null,[{key:"fromEulerAngle",value:function(t){var i=Math.sin(t.heading),n=Math.cos(t.heading),r=Math.sin(t.picth),s=Math.cos(t.picth),a=Math.sin(t.bank),o=Math.cos(t.bank);return new e(n*o+i*r*a,-n*a+i*r*o,i*s,a*s,o*s,-r,-i*o+n*r*a,a*i+n*r*o,n*s)}},{key:"fromWorldToObjectQuaternion",value:function(t){return new e(1-2*t.y*t.y-2*t.z*t.z,2*t.x*t.y+2*t.w*t.z,2*t.x*t.z-2*t.w*t.y,2*t.x*t.y-2*t.w*t.z,1-2*t.x*t.x-2*t.z*t.z,2*t.y*t.z+2*t.w*t.x,2*t.x*t.z+2*t.w*t.y,2*t.y*t.z-2*t.w*t.x,1-2*t.x*t.x-2*t.y*t.y)}},{key:"fromObjectToWorldQuaternion",value:function(t){return new e(1-2*t.y*t.y-2*t.z*t.z,2*t.x*t.y-2*t.w*t.z,2*t.x*t.z+2*t.w*t.y,2*t.x*t.y+2*t.w*t.z,1-2*t.x*t.x-2*t.z*t.z,2*t.y*t.z-2*t.w*t.x,2*t.x*t.z-2*t.w*t.y,2*t.y*t.z+2*t.w*t.x,1-2*t.x*t.x-2*t.y*t.y)}}]),e}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.wrapPi=function(t){return t+=Math.PI,t-=2*Math.floor(1*t/2/Math.PI)*Math.PI,t-=Math.PI},e.safeAcos=function(t){if(t>=1)return 0;if(t<=-1)return Math.PI;return Math.acos(t)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(0),a=(n=s)&&n.__esModule?n:{default:n},o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(3));var h=function(){function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=0,this.x=0,this.y=0,this.z=0,this.w=e,this.x=i,this.y=n,this.z=r}return r(t,[{key:"setToRotateAboutX",value:function(t){this.w=Math.cos(t/2),this.x=Math.sin(t/2),this.y=0,this.z=0}},{key:"setToRotateAboutY",value:function(t){this.w=Math.cos(t/2),this.x=0,this.y=Math.sin(t/2),this.z=0}},{key:"setToRotateAboutZ",value:function(t){this.w=Math.cos(t/2),this.x=0,this.y=0,this.z=Math.sin(t/2)}},{key:"setToRotateAboutAxis",value:function(t,e){if(a.default.getNorm(t)-1>=.01)throw Error("构建四元数时，旋转轴向量必须标准化");this.w=Math.cos(e/2),this.x=Math.sin(e/2)*t.x,this.y=Math.sin(e/2)*t.y,this.z=Math.sin(e/2)*t.z}},{key:"normalize",value:function(){var e=t.getNorm(this);e?(this.w=this.w/e,this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):(this.w=1,this.x=0,this.y=0,this.z=0)}},{key:"getRotationAngle",value:function(){return 2*o.safeAcos(this.w)}},{key:"getRotationAxis",value:function(){var t=Math.sqrt(1-this.w*this.w);return t?new a.default(this.x/t,this.y/t,this.z/t):new a.default(1,0,0)}}],[{key:"negate",value:function(e){return new t(-e.w,-e.x,-e.y,-e.z)}},{key:"getNorm",value:function(t){return Math.sqrt(t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z)}},{key:"getConjugate",value:function(e){return new t(e.w,-e.x,-e.y,-e.z)}},{key:"dotProduct",value:function(t,e){return t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z}},{key:"crossProduct",value:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];if(i.length<2)throw Error("四元数叉乘至少需要两个参数");return i.reduce(function(e,i){return new t(e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z,e.w*i.x+e.x*i.w+e.z*i.y-e.y*i.z,e.w*i.y+e.y*i.w+e.x*i.z-e.z*i.x,e.w*i.z+e.z*i.w+e.y*i.x-e.x*i.y)})}},{key:"scalarMultiply",value:function(e,i){return new t(e*i.w,e*i.x,e*i.y,e*i.z)}},{key:"log",value:function(e){var i=e.getRotationAngle();return new t(0,i/2*e.x,i/2*e.y,i/2*e.z)}},{key:"pow",value:function(e,i){if(Math.abs(e.w)>.999)return e;var n=o.safeAcos(e.w),r=n*i,s=Math.sin(r)/Math.sin(n);return new t(Math.cos(n),e.x*s,e.y*s,e.z*s)}},{key:"getAngularDisplacement",value:function(e,i){return t.crossProduct(t.getConjugate(e),i)}},{key:"slerp",value:function(e,i,n){var r=void 0,s=void 0,a=t.dotProduct(e,i);if(a<0&&(i=t.negate(i),a=-a),a>.9999)r=1-n,s=n;else{var o=Math.sqrt(1-a*a),h=Math.atan2(o,a);r=Math.sin((1-n)*h)/o,s=Math.sin(n*h)/o}return new t(e.w*r+i.w*s,e.x*r+i.x*s,e.y*r+i.y*s,e.z*s+i.z*s)}},{key:"fromRotationMatrix",value:function(e){var i=0,n=0,r=0,s=0,a=e.m11+e.m22+e.m33,o=e.m11-e.m22-e.m33,h=e.m22-e.m11-e.m33,u=e.m33-e.m11-e.m22,m=0,c=a;o>c&&(c=o,m=1),h>c&&(c=h,m=2),u>c&&(c=u,m=3);var l=.5*Math.sqrt(c+1),y=.25/l;switch(m){case 0:i=l,n=(e.m23-e.m32)*y,r=(e.m31-e.m13)*y,s=(e.m12-e.m21)*y;break;case 1:i=l,n=(e.m23-e.m32)*y,r=(e.m12+e.m21)*y,s=(e.m31+e.m13)*y;break;case 2:i=l,n=(e.m31-e.m13)*y,r=(e.m12+e.m21)*y,s=(e.m23+e.m32)*y;break;case 3:i=l,n=(e.m12-e.m21)*y,r=(e.m31+e.m13)*y,s=(e.m23+e.m13)*y}return new t(i,n,r,s)}},{key:"setObjectToWorldFromEulerAngles",value:function(e){var i=Math.sin(e.heading/2),n=Math.cos(e.heading/2),r=Math.sin(e.picth/2),s=Math.cos(e.picth/2),a=Math.sin(e.bank/2),o=Math.cos(e.bank/2);return new t(n*s*o+i*r*a,n*r*o+i*s*a,-n*r*a+i*s*o,-i*r*o+n*s*a)}},{key:"setWorldToObjectFromEulerAngles",value:function(e){return t.getConjugate(t.setObjectToWorldFromEulerAngles(e))}}]),t}();h.QuaternionIdentity=new h(1,0,0,0),e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(3));var s=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.heading=0,this.picth=0,this.bank=0,this.heading=e,this.picth=i,this.bank=n}return n(t,[{key:"canonize",value:function(){this.picth=r.wrapPi(this.picth),this.picth<-2/Math.PI?(this.picth=-Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI):this.picth>2/Math.PI&&(this.picth=Math.PI-this.picth,this.heading+=Math.PI,this.bank+=Math.PI),Math.abs(this.picth)>Math.PI/2-1e-4?(this.heading+=this.bank,this.bank=0):this.bank=r.wrapPi(this.bank),this.heading=r.wrapPi(this.heading)}}],[{key:"fromRotationMatrix",value:function(e){var i=void 0,n=void 0,r=void 0,s=-e.m23;return Math.abs(s)>.9999?(n=Math.PI/2*s,r=0,i=Math.atan2(-e.m31,e.m11)):(n=Math.asin(s),r=Math.atan2(e.m21,e.m22),i=Math.atan2(e.m13,e.m33)),new t(i,n,r)}},{key:"fromObjectToWorldQuaternion",value:function(e){var i=void 0,n=void 0,r=void 0,s=-2*(e.y*e.z-e.w*e.x);return Math.abs(s)>.9999?(n=Math.PI/2*s,r=0,i=Math.atan2(-e.x*e.z+e.w*e.y,.5-e.y*e.y-e.z*e.z)):(n=Math.asin(s),i=Math.atan2(e.x*e.z+e.w*e.y,.5-e.x*e.x-e.y*e.y),r=Math.atan2(e.x*e.y+e.w*e.z,.5-e.x*e.x-e.z*e.z)),new t(i,n,r)}},{key:"fromWorldToObjectQuaternion",value:function(e){var i=void 0,n=void 0,r=void 0,s=-2*(e.y*e.z+e.w*e.x);return Math.abs(s)>.9999?(n=Math.PI/2*s,r=0,i=Math.atan2(-e.x*e.z-e.w*e.y,.5-e.y*e.y-e.z*e.z)):(n=Math.asin(s),i=Math.atan2(e.x*e.z-e.w*e.y,.5-e.x*e.x-e.y*e.y),r=Math.atan2(e.x*e.y-e.w*e.z,.5-e.x*e.x-e.z*e.z)),new t(i,n,r)}}]),t}();e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Quaternion=e.RotationMatrix=e.Matrix4x3=e.EulerAngles=e.Vector3=void 0;var n=h(i(0)),r=h(i(5)),s=h(i(2)),a=h(i(1)),o=h(i(4));function h(t){return t&&t.__esModule?t:{default:t}}e.Vector3=n.default,e.EulerAngles=r.default,e.Matrix4x3=a.default,e.RotationMatrix=s.default,e.Quaternion=o.default}])});